const a5_0x4fb19e=a5_0xc005;(function(_0x138b0c,_0x2b92f5){const _0x4c0f46=a5_0xc005,_0x5e53d0=_0x138b0c();while(!![]){try{const _0x5b0dc2=-parseInt(_0x4c0f46(0x19d))/0x1*(parseInt(_0x4c0f46(0x1b4))/0x2)+-parseInt(_0x4c0f46(0x193))/0x3+-parseInt(_0x4c0f46(0x1bc))/0x4+parseInt(_0x4c0f46(0x1a4))/0x5+-parseInt(_0x4c0f46(0x1bb))/0x6+-parseInt(_0x4c0f46(0x1c8))/0x7+parseInt(_0x4c0f46(0x1bd))/0x8*(parseInt(_0x4c0f46(0x1a2))/0x9);if(_0x5b0dc2===_0x2b92f5)break;else _0x5e53d0['push'](_0x5e53d0['shift']());}catch(_0x281c77){_0x5e53d0['push'](_0x5e53d0['shift']());}}}(a5_0x540b,0xb4023));function a5_0x540b(){const _0x1c3a88=['processedRows','üìå\x20Final\x20Processed\x20Invoices:','6087591ShslgH','Internal\x20Server\x20Error','6827610zAgeVD','getMinutes','getFullYear','Kunag','Aupos','Sales_invoice_API','Posnr','...','Error\x20inserting\x20or\x20updating\x20sales\x20invoice\x20data','‚ö†Ô∏è\x20Received\x20empty\x20response\x20from\x20API','padStart','Vtweg','Unexpected\x20database\x20response','stringify','../models/salesInvoiceModel','Aubel','2FzKnAn','No\x20sales\x20invoice\x20data\x20found\x20in\x20SAP','Empty\x20response\x20from\x20API','env','‚ö†Ô∏è\x20No\x20valid\x20sales\x20invoice\x20data\x20received.','exports','replace','2576928AZMOEd','2065316ehWGhf','32kgFnec','TotalInvoice','length','getDate','PlannedOrder','Netwr','log','Vbeln','‚ùå\x20Error\x20syncing\x20sales\x20invoice\x20data:','‚ùå\x20API\x20Response\x20Format\x20Incorrect:','Fktyp','3434193NhWImE','axios','Database\x20error','Fkart','Fkdat','results','isArray','status','object','config','‚úÖ\x20API\x20Response\x20Received.\x20Length:','failedRows','Spart','json','‚ùå\x20Skipping\x20invalid\x20invoice\x20at\x20index\x20','toString','Wgbez','üöÄ\x20Starting\x20Sales\x20Invoice\x20Data\x20Sync...','filter','Vkorg','error','\x20sales\x20invoices...','3733788ayEAvj','message','warn','data','üìå\x20API\x20Response\x20Data:','üì¶\x20Received\x20','‚úÖ\x20Sales\x20invoice\x20data\x20synced\x20successfully','getHours','‚ùå\x20Error\x20fetching\x20SAP\x20sales\x20invoice\x20data:','match','652791mycrKq','Invalid\x20data\x20format\x20received\x20from\x20SAP','Werks'];a5_0x540b=function(){return _0x1c3a88;};return a5_0x540b();}function a5_0xc005(_0x5ce7a1,_0x209014){const _0x540ba2=a5_0x540b();return a5_0xc005=function(_0xc005d2,_0x487ec8){_0xc005d2=_0xc005d2-0x193;let _0x4dfc16=_0x540ba2[_0xc005d2];return _0x4dfc16;},a5_0xc005(_0x5ce7a1,_0x209014);}const axios=require(a5_0x4fb19e(0x1c9)),{insertOrUpdateSalesInvoices}=require(a5_0x4fb19e(0x1b2));require('dotenv')[a5_0x4fb19e(0x1d1)]();const API_URL=process[a5_0x4fb19e(0x1b7)][a5_0x4fb19e(0x1a9)],convertSAPDateTime=_0x4d4f79=>{const _0x443be3=a5_0x4fb19e;if(!_0x4d4f79||typeof _0x4d4f79!=='string')return null;const _0x46b54f=_0x4d4f79[_0x443be3(0x19c)](/\/Date\((\d+)(?:[+-]\d+)?\)\//);if(!_0x46b54f)return null;const _0x5af850=parseInt(_0x46b54f[0x1],0xa),_0x1d3b09=new Date(_0x5af850),_0xa3dbff=_0x59d1ef=>_0x59d1ef['toString']()[_0x443be3(0x1ae)](0x2,'0'),_0x50f166=_0x1d3b09[_0x443be3(0x1a6)]()+'-'+_0xa3dbff(_0x1d3b09['getMonth']()+0x1)+'-'+_0xa3dbff(_0x1d3b09[_0x443be3(0x1c0)]())+'\x20'+(_0xa3dbff(_0x1d3b09[_0x443be3(0x19a)]())+':'+_0xa3dbff(_0x1d3b09[_0x443be3(0x1a5)]())+':'+_0xa3dbff(_0x1d3b09['getSeconds']()));return _0x50f166;},convertToDecimal=_0x43bf58=>{const _0x52dbd9=a5_0x4fb19e;if(!_0x43bf58||isNaN(_0x43bf58))return 0x0;return parseFloat(_0x43bf58[_0x52dbd9(0x1d7)]()[_0x52dbd9(0x1ba)](',','.'));},fetchSAPSalesInvoices=async()=>{const _0x231ecd=a5_0x4fb19e;try{console[_0x231ecd(0x1c3)]('üîç\x20Fetching\x20Sales\x20Invoice\x20Data\x20from\x20API:',API_URL);const _0x3c6146=await axios['get'](API_URL,{'auth':{'username':process[_0x231ecd(0x1b7)]['SAP_USERNAME'],'password':process[_0x231ecd(0x1b7)]['SAP_PASSWORD']},'headers':{'Accept':'application/json'},'responseType':_0x231ecd(0x1d5)});if(!_0x3c6146[_0x231ecd(0x196)]){console[_0x231ecd(0x195)](_0x231ecd(0x1ad));throw new Error(_0x231ecd(0x1b6));}console[_0x231ecd(0x1c3)](_0x231ecd(0x1d2),JSON[_0x231ecd(0x1b1)](_0x3c6146[_0x231ecd(0x196)])[_0x231ecd(0x1bf)]),console['log'](_0x231ecd(0x197),JSON[_0x231ecd(0x1b1)](_0x3c6146[_0x231ecd(0x196)],null,0x2));if(!_0x3c6146[_0x231ecd(0x196)]['d']||!Array[_0x231ecd(0x1ce)](_0x3c6146[_0x231ecd(0x196)]['d']['results'])){console[_0x231ecd(0x1dc)](_0x231ecd(0x1c6),JSON[_0x231ecd(0x1b1)](_0x3c6146[_0x231ecd(0x196)])['slice'](0x0,0xc8)+_0x231ecd(0x1ab));throw new Error(_0x231ecd(0x19e));}const _0x4b71b9=_0x3c6146[_0x231ecd(0x196)]['d'][_0x231ecd(0x1cd)]||[];return console[_0x231ecd(0x1c3)](_0x231ecd(0x198)+_0x4b71b9[_0x231ecd(0x1bf)]+'\x20sales\x20invoices'),_0x4b71b9;}catch(_0x5b2b3f){console['error'](_0x231ecd(0x19b),_0x5b2b3f[_0x231ecd(0x194)]);throw new Error('SAP\x20API\x20Error:\x20'+_0x5b2b3f[_0x231ecd(0x194)]);}},fetchAndStoreSalesInvoices=async(_0x1ce5ab,_0x254471)=>{const _0x346a87=a5_0x4fb19e;try{console[_0x346a87(0x1c3)](_0x346a87(0x1d9));const _0x3068e0=await fetchSAPSalesInvoices();if(!Array[_0x346a87(0x1ce)](_0x3068e0)||_0x3068e0[_0x346a87(0x1bf)]===0x0){console[_0x346a87(0x195)](_0x346a87(0x1b8));if(_0x254471)return _0x254471['status'](0x190)[_0x346a87(0x1d5)]({'message':_0x346a87(0x1b5)});return;}console[_0x346a87(0x1c3)]('üì¶\x20Processing\x20'+_0x3068e0[_0x346a87(0x1bf)]+_0x346a87(0x1dd));const _0x3525c2=_0x3068e0['map']((_0x56798b,_0x54342b)=>{const _0xd17c11=_0x346a87;if(!_0x56798b||typeof _0x56798b!==_0xd17c11(0x1d0))return console[_0xd17c11(0x1dc)](_0xd17c11(0x1d6)+_0x54342b+':',_0x56798b),null;return{'Vbeln':String(_0x56798b?.[_0xd17c11(0x1c4)]||''),'Posnr':String(_0x56798b?.[_0xd17c11(0x1aa)]||''),'Matnr':String(_0x56798b?.['Matnr']||''),'PlannedOrder':convertToDecimal(_0x56798b?.[_0xd17c11(0x1c1)]),'Wgbez':String(_0x56798b?.[_0xd17c11(0x1d8)]||''),'Bzirk':String(_0x56798b?.['Bzirk']||''),'Netwr':convertToDecimal(_0x56798b?.[_0xd17c11(0x1c2)]),'Vtweg':String(_0x56798b?.[_0xd17c11(0x1af)]||''),'Matkl':String(_0x56798b?.['Matkl']||''),'TotalInvoice':convertToDecimal(_0x56798b?.[_0xd17c11(0x1be)]),'Spart':String(_0x56798b?.[_0xd17c11(0x1d4)]||''),'Zone':String(_0x56798b?.['Zone']||''),'Fkart':String(_0x56798b?.[_0xd17c11(0x1cb)]||''),'Kunag':String(_0x56798b?.[_0xd17c11(0x1a7)]||''),'Fktyp':String(_0x56798b?.[_0xd17c11(0x1c7)]||''),'Aupos':String(_0x56798b?.[_0xd17c11(0x1a8)]||''),'Werks':String(_0x56798b?.[_0xd17c11(0x19f)]||''),'Vkorg':String(_0x56798b?.[_0xd17c11(0x1db)]||''),'Waerk':String(_0x56798b?.['Waerk']||''),'Gjahr':String(_0x56798b?.['Gjahr']||''),'Fkdat':convertSAPDateTime(_0x56798b?.[_0xd17c11(0x1cc)]),'Aubel':String(_0x56798b?.[_0xd17c11(0x1b3)]||'')};})[_0x346a87(0x1da)](Boolean);console[_0x346a87(0x1c3)](_0x346a87(0x1a1),JSON[_0x346a87(0x1b1)](_0x3525c2,null,0x2));const _0x1ad3cf=await insertOrUpdateSalesInvoices(_0x3525c2);if(!_0x1ad3cf||typeof _0x1ad3cf!==_0x346a87(0x1d0)||!_0x1ad3cf['success']){console[_0x346a87(0x1dc)]('‚ùå\x20Error\x20inserting\x20or\x20updating\x20sales\x20invoice\x20data:',_0x1ad3cf?.[_0x346a87(0x1dc)]||_0x346a87(0x1b0));if(_0x254471)return _0x254471[_0x346a87(0x1cf)](0x1f4)[_0x346a87(0x1d5)]({'message':_0x346a87(0x1ac),'error':_0x1ad3cf?.[_0x346a87(0x1dc)]||_0x346a87(0x1ca)});return;}console[_0x346a87(0x1c3)]('‚úÖ\x20Sales\x20Invoice\x20Data\x20Sync\x20Completed\x20Successfully');if(_0x254471)return _0x254471[_0x346a87(0x1cf)](0xc8)['json']({'message':_0x346a87(0x199),'insertedRows':_0x1ad3cf[_0x346a87(0x1a0)][_0x346a87(0x1bf)],'updatedRows':_0x1ad3cf[_0x346a87(0x1a0)][_0x346a87(0x1bf)],'failedRows':_0x1ad3cf[_0x346a87(0x1d3)][_0x346a87(0x1bf)],'errors':_0x1ad3cf[_0x346a87(0x1d3)]});}catch(_0x408035){console[_0x346a87(0x1dc)](_0x346a87(0x1c5),_0x408035[_0x346a87(0x194)]);if(_0x254471)return _0x254471[_0x346a87(0x1cf)](0x1f4)[_0x346a87(0x1d5)]({'message':_0x346a87(0x1a3),'error':_0x408035['message']});}};module[a5_0x4fb19e(0x1b9)]={'fetchAndStoreSalesInvoices':fetchAndStoreSalesInvoices};