const a2_0x5c8313=a2_0x1d76;(function(_0x47ae32,_0x3de983){const _0x25c30b=a2_0x1d76,_0x163187=_0x47ae32();while(!![]){try{const _0xf7f165=-parseInt(_0x25c30b(0x189))/0x1+parseInt(_0x25c30b(0x181))/0x2*(-parseInt(_0x25c30b(0x162))/0x3)+-parseInt(_0x25c30b(0x182))/0x4+-parseInt(_0x25c30b(0x184))/0x5+parseInt(_0x25c30b(0x174))/0x6+-parseInt(_0x25c30b(0x169))/0x7*(-parseInt(_0x25c30b(0x15c))/0x8)+parseInt(_0x25c30b(0x175))/0x9*(parseInt(_0x25c30b(0x18b))/0xa);if(_0xf7f165===_0x3de983)break;else _0x163187['push'](_0x163187['shift']());}catch(_0x13c5cc){_0x163187['push'](_0x163187['shift']());}}}(a2_0x5efc,0xed468));const axios=require(a2_0x5c8313(0x186)),{upsertCustomer}=require('../models/customerModel');function a2_0x1d76(_0x37eca7,_0x13f4d8){const _0x5efcab=a2_0x5efc();return a2_0x1d76=function(_0x1d765d,_0x23779d){_0x1d765d=_0x1d765d-0x157;let _0x3a07d3=_0x5efcab[_0x1d765d];return _0x3a07d3;},a2_0x1d76(_0x37eca7,_0x13f4d8);}require(a2_0x5c8313(0x167))['config']();const API_URL=process['env']['CUSTOMER_API'],fetchSAPCustomers=async()=>{const _0x1ed297=a2_0x5c8313;try{console[_0x1ed297(0x15d)]('üîç\x20Fetching\x20Customer\x20Data\x20from\x20API:',API_URL);const _0xdd1da1=await axios['get'](API_URL,{'auth':{'username':process[_0x1ed297(0x16b)][_0x1ed297(0x170)],'password':process['env'][_0x1ed297(0x17a)]},'headers':{'Accept':_0x1ed297(0x18a)},'responseType':_0x1ed297(0x168)});if(!_0xdd1da1[_0x1ed297(0x179)]){console[_0x1ed297(0x180)]('‚ö†Ô∏è\x20Received\x20empty\x20response\x20from\x20API');throw new Error('Empty\x20response\x20from\x20API');}return console[_0x1ed297(0x15d)](_0x1ed297(0x173),JSON[_0x1ed297(0x177)](_0xdd1da1[_0x1ed297(0x179)])[_0x1ed297(0x15e)]),console[_0x1ed297(0x15d)](_0x1ed297(0x17c),JSON['stringify'](_0xdd1da1['data'],null,0x2)),_0xdd1da1[_0x1ed297(0x179)];}catch(_0x561c28){console[_0x1ed297(0x16c)]('‚ùå\x20Error\x20fetching\x20SAP\x20customer\x20data:',_0x561c28[_0x1ed297(0x17f)]);throw new Error('SAP\x20API\x20Error:\x20'+_0x561c28['message']);}},fetchAndStoreCustomers=async(_0x42fdb1,_0x7653b7)=>{const _0x50111f=a2_0x5c8313;try{console['log'](_0x50111f(0x15a));const _0x52bbb2=await fetchSAPCustomers();if(!_0x52bbb2||typeof _0x52bbb2!==_0x50111f(0x185)||!_0x52bbb2['d']||!Array[_0x50111f(0x17b)](_0x52bbb2['d'][_0x50111f(0x178)]))return console[_0x50111f(0x16c)](_0x50111f(0x187),JSON[_0x50111f(0x177)](_0x52bbb2)[_0x50111f(0x164)](0x0,0xa)+_0x50111f(0x159)),_0x7653b7['status'](0x190)['json']({'message':'Invalid\x20data\x20format\x20received\x20from\x20SAP'});console['log'](_0x50111f(0x160)+_0x52bbb2['d'][_0x50111f(0x178)][_0x50111f(0x15e)]+_0x50111f(0x188));const _0x2471ec=_0x52bbb2['d'][_0x50111f(0x178)][_0x50111f(0x158)]((_0x9b4045,_0x21fffe)=>{const _0x23765d=_0x50111f;return console[_0x23765d(0x15d)](_0x23765d(0x17e)+(_0x21fffe+0x1)+':',_0x9b4045['Kunnr']),{'Kunnr':String(_0x9b4045['Kunnr']),'Zone':String(_0x9b4045[_0x23765d(0x15f)]),'Vkorg':String(_0x9b4045['Vkorg']),'Bzirk':String(_0x9b4045[_0x23765d(0x15b)]||''),'Name1':String(_0x9b4045[_0x23765d(0x16a)]),'Bztxt':String(_0x9b4045[_0x23765d(0x171)]||'')};})[_0x50111f(0x163)](Boolean);console[_0x50111f(0x15d)](_0x50111f(0x166),JSON[_0x50111f(0x177)](_0x2471ec,null,0x2));const _0x1c8578=await upsertCustomer(_0x2471ec);if(!_0x1c8578||typeof _0x1c8578!==_0x50111f(0x185)||!_0x1c8578['success']){console[_0x50111f(0x16c)](_0x50111f(0x16e),_0x1c8578?.['error']||_0x50111f(0x17d));if(_0x7653b7)return _0x7653b7['status'](0x1f4)[_0x50111f(0x168)]({'message':_0x50111f(0x183),'error':_0x1c8578?.[_0x50111f(0x16c)]||_0x50111f(0x157)});return;}console[_0x50111f(0x15d)](_0x50111f(0x172));if(_0x7653b7)return _0x7653b7[_0x50111f(0x165)](0xc8)[_0x50111f(0x168)]({'message':'\x20Customer\x20data\x20synced\x20successfully','insertedRows':_0x1c8578[_0x50111f(0x16d)]['length'],'updatedRows':_0x1c8578[_0x50111f(0x16d)][_0x50111f(0x15e)],'failedRows':_0x1c8578[_0x50111f(0x176)][_0x50111f(0x15e)],'errors':_0x1c8578[_0x50111f(0x176)]});}catch(_0x3e5ca4){console[_0x50111f(0x16c)](_0x50111f(0x161),_0x3e5ca4[_0x50111f(0x17f)]);if(_0x7653b7)return _0x7653b7['status'](0x1f4)['json']({'message':_0x50111f(0x16f),'error':_0x3e5ca4[_0x50111f(0x17f)]});}};function a2_0x5efc(){const _0x187e4d=['log','length','Zone','üì¶\x20Received\x20','‚ùå\x20Error\x20syncing\x20customer\x20data:','1992LciWqH','filter','slice','status','üìå\x20Final\x20Data\x20Before\x20Upsertion:','dotenv','json','249536tuGiYO','Name1','env','error','processedRows','\x20Error\x20inserted\x20or\x20updating\x20customer\x20data:','Internal\x20Server\x20Error','SAP_USERNAME','Bztxt','‚úÖ\x20Customer\x20Data\x20Sync\x20Completed\x20Successfully\x20','‚úÖ\x20API\x20Response\x20Received.\x20Length:','1144572BiEhhm','3106926XGHPOM','failedRows','stringify','results','data','SAP_PASSWORD','isArray','\x20API\x20Response\x20Data:','Unexpected\x20database\x20response','üîÑ\x20Processing\x20Customer\x20','message','warn','3702ZvSAlo','3903300jREcUo','Error\x20insering\x20or\x20updating\x20customer\x20data','5163820jPjjzL','object','axios','‚ùå\x20API\x20Response\x20Format\x20Incorrect:','\x20customers\x20from\x20API','287071xgqPXY','application/json','70owHBqu','Database\x20error','map','...','üöÄ\x20Starting\x20Customer\x20Data\x20Sync...','Bzirk','424GoLLZx'];a2_0x5efc=function(){return _0x187e4d;};return a2_0x5efc();}module['exports']={'fetchAndStoreCustomers':fetchAndStoreCustomers};