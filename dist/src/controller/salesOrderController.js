const a5_0x5b4933=a5_0x1ff2;(function(_0x179b3e,_0x41f004){const _0x5e4add=a5_0x1ff2,_0x3667d4=_0x179b3e();while(!![]){try{const _0x12ef1a=-parseInt(_0x5e4add(0xe2))/0x1+-parseInt(_0x5e4add(0xc2))/0x2+-parseInt(_0x5e4add(0xbc))/0x3+parseInt(_0x5e4add(0xc4))/0x4+parseInt(_0x5e4add(0xaf))/0x5+parseInt(_0x5e4add(0xca))/0x6*(-parseInt(_0x5e4add(0xbe))/0x7)+parseInt(_0x5e4add(0xd5))/0x8*(parseInt(_0x5e4add(0xb0))/0x9);if(_0x12ef1a===_0x41f004)break;else _0x3667d4['push'](_0x3667d4['shift']());}catch(_0x2d4812){_0x3667d4['push'](_0x3667d4['shift']());}}}(a5_0x5d34,0xd2794));function a5_0x5d34(){const _0x5df62c=['864VIBXVo','error','üöÄ\x20Starting\x20Sales\x20Order\x20Data\x20Sync...','Vbeln','SAP_USERNAME','‚ùå\x20Error\x20fetching\x20SAP\x20sales\x20order\x20data:','status','Waerk','object','length','warn','8YqtMJZ','json','0.00','SAP_PASSWORD','Wgbez','Kursk','stringify','Error\x20inserting\x20or\x20updating\x20sales\x20order\x20data','isArray','processedRows','Erdat','Spart','‚ùå\x20Error\x20processing\x20sales\x20order\x20data:','1558847zrFEPd','results','replace','Kunnr','split','failedRows','üì¶\x20Received\x20','../models/salesOrderModel','filter','Posnr','PlannedOrder','Auart','config','...','map','7353245NLEBYL','26198469NJKleg','Bzirk','message','match','Zone','log','env','\x20sales\x20orders\x20from\x20API','Vtweg','exports','Vkorg','slice','2899302gdiNOW','üîç\x20Fetching\x20Sales\x20Order\x20Data\x20from\x20API:','42518gLPFfN','Empty\x20response\x20from\x20API','Bztxt','data','1076318sFgmpx','get','1674424PSjJFw','Database\x20error','‚úÖ\x20API\x20Response\x20Received.\x20Length:','‚úÖ\x20Sales\x20Order\x20Data\x20Sync\x20Completed\x20Successfully','Vtext','Internal\x20Server\x20Error'];a5_0x5d34=function(){return _0x5df62c;};return a5_0x5d34();}const axios=require('axios'),{insertOrUpdateSalesOrders}=require(a5_0x5b4933(0xe9));require('dotenv')[a5_0x5b4933(0xee)]();function a5_0x1ff2(_0x52c723,_0x404ed7){const _0x5d34d2=a5_0x5d34();return a5_0x1ff2=function(_0x1ff223,_0x5ea5cf){_0x1ff223=_0x1ff223-0xaf;let _0x4cc7a1=_0x5d34d2[_0x1ff223];return _0x4cc7a1;},a5_0x1ff2(_0x52c723,_0x404ed7);}const API_URL=process[a5_0x5b4933(0xb6)]['Sales_Order_API'],convertSAPDateTime=_0x15b6d8=>{const _0x71f485=a5_0x5b4933;if(!_0x15b6d8)return null;const _0x5c1964=_0x15b6d8[_0x71f485(0xb3)](/\d+/);if(!_0x5c1964)return null;const _0x320476=parseInt(_0x5c1964[0x0],0xa),_0x62a29e=new Date(_0x320476);return _0x62a29e['toISOString']()[_0x71f485(0xe4)]('T','\x20')[_0x71f485(0xe6)]('.')[0x0];},convertToDecimal=_0x1248e6=>{const _0x51ad67=a5_0x5b4933;if(!_0x1248e6||isNaN(_0x1248e6))return _0x51ad67(0xd7);return parseFloat(_0x1248e6['toString']()[_0x51ad67(0xe4)](',','.'))['toFixed'](0x2);},fetchSAPSalesOrders=async()=>{const _0x416c9f=a5_0x5b4933;try{console[_0x416c9f(0xb5)](_0x416c9f(0xbd),API_URL);const _0x567181=await axios[_0x416c9f(0xc3)](API_URL,{'auth':{'username':process['env'][_0x416c9f(0xce)],'password':process[_0x416c9f(0xb6)][_0x416c9f(0xd8)]},'headers':{'Accept':'application/json'}});if(!_0x567181['data']){console[_0x416c9f(0xd4)]('‚ö†Ô∏è\x20Received\x20empty\x20response\x20from\x20API');throw new Error(_0x416c9f(0xbf));}return console[_0x416c9f(0xb5)](_0x416c9f(0xc6),JSON[_0x416c9f(0xdb)](_0x567181[_0x416c9f(0xc1)])[_0x416c9f(0xd3)]),console[_0x416c9f(0xb5)]('üìå\x20API\x20Response\x20Data:',JSON['stringify'](_0x567181['data'],null,0x2)),_0x567181[_0x416c9f(0xc1)];}catch(_0x2dcd8d){console[_0x416c9f(0xcb)](_0x416c9f(0xcf),_0x2dcd8d[_0x416c9f(0xb2)]);throw new Error('SAP\x20API\x20Error:\x20'+_0x2dcd8d['message']);}},fetchAndStoreSalesOrders=async(_0x5c167b,_0x43b530)=>{const _0x347a4b=a5_0x5b4933;try{console['log'](_0x347a4b(0xcc));const _0x1a9a65=await fetchSAPSalesOrders();if(!_0x1a9a65||typeof _0x1a9a65!=='object'||!_0x1a9a65['d']||!Array[_0x347a4b(0xdd)](_0x1a9a65['d'][_0x347a4b(0xe3)])){console[_0x347a4b(0xcb)]('‚ùå\x20API\x20Response\x20Format\x20Incorrect:',JSON[_0x347a4b(0xdb)](_0x1a9a65)[_0x347a4b(0xbb)](0x0,0xa)+_0x347a4b(0xef));if(_0x43b530)return _0x43b530[_0x347a4b(0xd0)](0x190)[_0x347a4b(0xd6)]({'message':'Invalid\x20data\x20format\x20received\x20from\x20SAP'});throw new Error('Invalid\x20data\x20format\x20received\x20from\x20SAP');}console[_0x347a4b(0xb5)](_0x347a4b(0xe8)+_0x1a9a65['d'][_0x347a4b(0xe3)]['length']+_0x347a4b(0xb7));const _0x342566=_0x1a9a65['d']['results'][_0x347a4b(0xf0)]((_0xc477a1,_0x38c69f)=>{const _0x1e3297=_0x347a4b;if(!_0xc477a1||typeof _0xc477a1!==_0x1e3297(0xd2))return console['error']('‚ùå\x20Skipping\x20invalid\x20entry\x20at\x20index\x20'+_0x38c69f+':',_0xc477a1),null;return{'Vtweg':String(_0xc477a1?.[_0x1e3297(0xb8)]||''),'Posnr':String(_0xc477a1?.[_0x1e3297(0xeb)]||''),'Bzirk':String(_0xc477a1?.[_0x1e3297(0xb1)]||''),'Vbeln':String(_0xc477a1?.[_0x1e3297(0xcd)]||''),'Spart':String(_0xc477a1?.[_0x1e3297(0xe0)]||''),'Gjahr':parseInt(_0xc477a1?.['Gjahr'])||null,'Bztxt':String(_0xc477a1?.[_0x1e3297(0xc0)]||''),'Vtext':String(_0xc477a1?.[_0x1e3297(0xc8)]||''),'PlannedOrder':convertToDecimal(_0xc477a1?.[_0x1e3297(0xec)]),'Kunnr':String(_0xc477a1?.[_0x1e3297(0xe5)]||''),'TotalInvoice':convertToDecimal(_0xc477a1?.['TotalInvoice']),'Erdat':convertSAPDateTime(_0xc477a1?.[_0x1e3297(0xdf)]),'Zone':String(_0xc477a1?.[_0x1e3297(0xb4)]||''),'Auart':String(_0xc477a1?.[_0x1e3297(0xed)]||''),'Kursk':convertToDecimal(_0xc477a1?.[_0x1e3297(0xda)],0x5),'Vkorg':String(_0xc477a1?.[_0x1e3297(0xba)]||''),'Netwr':convertToDecimal(_0xc477a1?.['Netwr'],0x2),'Waerk':String(_0xc477a1?.[_0x1e3297(0xd1)]||''),'Matnr':String(_0xc477a1?.['Matnr']||''),'Matkl':String(_0xc477a1?.['Matkl']||''),'Wgbez':String(_0xc477a1?.[_0x1e3297(0xd9)]||'')};})[_0x347a4b(0xea)](Boolean);console['log']('üìå\x20Final\x20Data\x20Before\x20Insert/Update:',JSON['stringify'](_0x342566,null,0x2));const _0x33f628=await insertOrUpdateSalesOrders(_0x342566);if(!_0x33f628||typeof _0x33f628!==_0x347a4b(0xd2)||!_0x33f628['success']){console[_0x347a4b(0xcb)](_0x347a4b(0xe1),_0x33f628?.[_0x347a4b(0xcb)]||'Unexpected\x20database\x20response');if(_0x43b530)return _0x43b530['status'](0x1f4)['json']({'message':_0x347a4b(0xdc),'error':_0x33f628?.[_0x347a4b(0xcb)]||_0x347a4b(0xc5)});throw new Error('Database\x20error\x20occurred\x20while\x20inserting/updating\x20sales\x20orders.');}console[_0x347a4b(0xb5)](_0x347a4b(0xc7));if(_0x43b530)return _0x43b530[_0x347a4b(0xd0)](0xc8)[_0x347a4b(0xd6)]({'message':'‚úÖ\x20Sales\x20order\x20data\x20inserted/updated\x20successfully','insertedRows':_0x33f628[_0x347a4b(0xde)]['length'],'updatedRows':_0x33f628[_0x347a4b(0xde)][_0x347a4b(0xd3)],'failedRows':_0x33f628[_0x347a4b(0xe7)][_0x347a4b(0xd3)],'errors':_0x33f628[_0x347a4b(0xe7)]});return{'success':!![],'message':'Sales\x20orders\x20synced\x20successfully'};}catch(_0x1d7434){return console[_0x347a4b(0xcb)]('‚ùå\x20Error\x20syncing\x20sales\x20order\x20data:',_0x1d7434[_0x347a4b(0xb2)]),_0x43b530?_0x43b530[_0x347a4b(0xd0)](0x1f4)[_0x347a4b(0xd6)]({'message':_0x347a4b(0xc9),'error':_0x1d7434[_0x347a4b(0xb2)]}):{'success':![],'error':_0x1d7434['message']};}};module[a5_0x5b4933(0xb9)]={'fetchAndStoreSalesOrders':fetchAndStoreSalesOrders};