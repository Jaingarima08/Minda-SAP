const a7_0x329562=a7_0x2c17;(function(_0x27d476,_0x3c78b7){const _0x443a2a=a7_0x2c17,_0x34a9e9=_0x27d476();while(!![]){try{const _0x17d91e=-parseInt(_0x443a2a(0xd3))/0x1*(parseInt(_0x443a2a(0xf1))/0x2)+-parseInt(_0x443a2a(0xfc))/0x3+parseInt(_0x443a2a(0xc1))/0x4+parseInt(_0x443a2a(0xea))/0x5+-parseInt(_0x443a2a(0xcf))/0x6+parseInt(_0x443a2a(0xe1))/0x7*(-parseInt(_0x443a2a(0xf2))/0x8)+parseInt(_0x443a2a(0xec))/0x9;if(_0x17d91e===_0x3c78b7)break;else _0x34a9e9['push'](_0x34a9e9['shift']());}catch(_0x39e100){_0x34a9e9['push'](_0x34a9e9['shift']());}}}(a7_0x1e52,0xb460d));const axios=require(a7_0x329562(0xfa)),SalesModel=require('../models/tagetValueModel');require(a7_0x329562(0x100))['config']();function a7_0x2c17(_0x5f4255,_0x39d2df){const _0x1e52b6=a7_0x1e52();return a7_0x2c17=function(_0x2c174d,_0x14700e){_0x2c174d=_0x2c174d-0xc1;let _0x7d79d7=_0x1e52b6[_0x2c174d];return _0x7d79d7;},a7_0x2c17(_0x5f4255,_0x39d2df);}const API_URL=process['env'][a7_0x329562(0xef)],convertToDecimal=_0x2d2b32=>{const _0x4a41e8=a7_0x329562;if(!_0x2d2b32||isNaN(_0x2d2b32))return _0x4a41e8(0xc4);return parseFloat(_0x2d2b32[_0x4a41e8(0xd4)]()[_0x4a41e8(0x102)](',','.'))['toFixed'](0x2);},fetchSAPSalesData=async()=>{const _0x208e21=a7_0x329562;try{console['log'](_0x208e21(0xc8),API_URL);const _0x1bc295=await axios['get'](API_URL,{'auth':{'username':process[_0x208e21(0xda)][_0x208e21(0xf9)],'password':process[_0x208e21(0xda)][_0x208e21(0xe4)]},'headers':{'Accept':_0x208e21(0xe3)}});if(!_0x1bc295[_0x208e21(0xd9)]){console[_0x208e21(0xce)]('‚ö†Ô∏è\x20Received\x20empty\x20response\x20from\x20API');throw new Error(_0x208e21(0xf3));}console[_0x208e21(0xd0)](_0x208e21(0xfd),JSON[_0x208e21(0x104)](_0x1bc295['data'])[_0x208e21(0xde)]),console[_0x208e21(0xd0)](_0x208e21(0x103),JSON['stringify'](_0x1bc295[_0x208e21(0xd9)],null,0x2));const _0x55afd7=_0x1bc295[_0x208e21(0xd9)]?.['d']?.[_0x208e21(0xcb)];if(!Array['isArray'](_0x55afd7)){console[_0x208e21(0xdf)](_0x208e21(0xff),JSON[_0x208e21(0x104)](_0x1bc295[_0x208e21(0xd9)])[_0x208e21(0xd8)](0x0,0xc8)+_0x208e21(0xe8));throw new Error(_0x208e21(0xfb));}return console[_0x208e21(0xd0)](_0x208e21(0xc9)+_0x55afd7[_0x208e21(0xde)]+'\x20sales\x20data\x20entries'),_0x55afd7;}catch(_0x4d6233){console[_0x208e21(0xdf)](_0x208e21(0xf0),_0x4d6233[_0x208e21(0xc3)]);throw new Error(_0x208e21(0xd7)+_0x4d6233[_0x208e21(0xc3)]);}},fetchAndInsertSalesData=async(_0x3b1b84,_0x3c0c73)=>{const _0x127123=a7_0x329562;try{console[_0x127123(0xd0)]('üöÄ\x20Starting\x20Sales\x20Data\x20Sync...');const _0x34df24=await fetchSAPSalesData();if(!Array[_0x127123(0xe0)](_0x34df24)||_0x34df24[_0x127123(0xde)]===0x0){console[_0x127123(0xce)](_0x127123(0xf7));if(_0x3c0c73)return _0x3c0c73[_0x127123(0xd6)](0x190)[_0x127123(0xcd)]({'message':_0x127123(0xc7)});return;}console[_0x127123(0xd0)](_0x127123(0xe2)+_0x34df24['length']+_0x127123(0xe9));const _0x5d2302=_0x34df24[_0x127123(0xf5)]((_0x82b544,_0x3fc8f4)=>{const _0x564fc0=_0x127123;if(!_0x82b544||typeof _0x82b544!==_0x564fc0(0xc2))return console[_0x564fc0(0xdf)](_0x564fc0(0xf6)+_0x3fc8f4+':',_0x82b544),null;return{'Gjahr':String(_0x82b544?.[_0x564fc0(0xca)]||''),'MonthD':String(_0x82b544?.[_0x564fc0(0xf8)]||''),'Bzirk':String(_0x82b544?.[_0x564fc0(0xd1)]||''),'Matkl':String(_0x82b544?.[_0x564fc0(0xd2)]||''),'Spart':String(_0x82b544?.['Spart']||''),'Zone':String(_0x82b544?.[_0x564fc0(0xc5)]||''),'Bztxt':String(_0x82b544?.[_0x564fc0(0xdd)]||''),'Wgbez':String(_0x82b544?.[_0x564fc0(0xc6)]||''),'PlannedOrder':convertToDecimal(_0x82b544?.[_0x564fc0(0xdb)]),'TotalInvoice':convertToDecimal(_0x82b544?.['TotalInvoice'])};})[_0x127123(0xd5)](Boolean);console[_0x127123(0xd0)]('üìå\x20Final\x20Data\x20Before\x20Processing:',JSON[_0x127123(0x104)](_0x5d2302,null,0x2));const _0x5f4553=await SalesModel[_0x127123(0xee)](_0x5d2302);if(!_0x5f4553||typeof _0x5f4553!==_0x127123(0xc2)||!_0x5f4553[_0x127123(0xcc)]){console[_0x127123(0xdf)](_0x127123(0xe6),_0x5f4553?.[_0x127123(0xdf)]||_0x127123(0xe7));if(_0x3c0c73)return _0x3c0c73['status'](0x1f4)[_0x127123(0xcd)]({'message':'Error\x20inserting\x20or\x20updating\x20sales\x20data','error':_0x5f4553?.[_0x127123(0xdf)]||_0x127123(0xfe)});return;}console[_0x127123(0xd0)](_0x127123(0xeb));if(_0x3c0c73)return _0x3c0c73['status'](0xc8)[_0x127123(0xcd)]({'message':_0x127123(0x101),'insertedRows':_0x5f4553['processedRows'][_0x127123(0xde)],'updatedRows':_0x5f4553['processedRows'][_0x127123(0xde)],'failedRows':_0x5f4553[_0x127123(0xf4)]['length'],'errors':_0x5f4553['failedRows']});}catch(_0x37762a){console[_0x127123(0xdf)](_0x127123(0xe5),_0x37762a[_0x127123(0xc3)]);if(_0x3c0c73)return _0x3c0c73[_0x127123(0xd6)](0x1f4)['json']({'message':_0x127123(0xed),'error':_0x37762a[_0x127123(0xc3)]});}};function a7_0x1e52(){const _0x431dfc=['failedRows','map','‚ùå\x20Skipping\x20invalid\x20entry\x20at\x20index\x20','‚ö†Ô∏è\x20No\x20valid\x20sales\x20data\x20received.','MonthD','SAP_USERNAME','axios','Invalid\x20data\x20format\x20received\x20from\x20SAP','3127719dfqfHD','‚úÖ\x20API\x20Response\x20Received.Length:','Database\x20error','‚ùå\x20Invalid\x20API\x20Response\x20Format:','dotenv','‚úÖ\x20Sales\x20data\x20synced\x20successfully','replace','üìå\x20API\x20Response\x20Data:','stringify','1180364RxHaNV','object','message','0.00','Zone','Wgbez','No\x20sales\x20data\x20found\x20in\x20SAP','üîç\x20Fetching\x20Sales\x20Data\x20from\x20API:','üì¶\x20Received\x20','Gjahr','results','success','json','warn','5361846VWZOBo','log','Bzirk','Matkl','34778ZDfneA','toString','filter','status','SAP\x20API\x20Error:\x20','slice','data','env','PlannedOrder','exports','Bztxt','length','error','isArray','7CznVmm','üì¶\x20Processing\x20','application/json','SAP_PASSWORD','‚ùå\x20Error\x20syncing\x20sales\x20data:','‚ùå\x20Error\x20inserting\x20or\x20updating\x20sales\x20data:','Unexpected\x20database\x20response','...','\x20sales\x20data\x20entries...','4561105zlatqk','‚úÖ\x20Sales\x20Data\x20Sync\x20Completed\x20Successfully','26322570sdbnNz','Internal\x20Server\x20Error','insertOrUpdateSalesData','Taget_Value_API','‚ùå\x20Error\x20fetching\x20SAP\x20sales\x20data:','74WgajBt','1361704IRFtrU','Empty\x20response\x20from\x20API'];a7_0x1e52=function(){return _0x431dfc;};return a7_0x1e52();}module[a7_0x329562(0xdc)]={'fetchAndInsertSalesData':fetchAndInsertSalesData};