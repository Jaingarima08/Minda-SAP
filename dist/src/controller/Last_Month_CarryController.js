const a3_0x353b2d=a3_0x7f64;function a3_0x7f64(_0x3d5902,_0x16cc32){const _0x2758db=a3_0x2758();return a3_0x7f64=function(_0x7f6464,_0x48f063){_0x7f6464=_0x7f6464-0x115;let _0x106988=_0x2758db[_0x7f6464];return _0x106988;},a3_0x7f64(_0x3d5902,_0x16cc32);}(function(_0x7b4e28,_0xf83b9e){const _0x19cdd3=a3_0x7f64,_0x35aabe=_0x7b4e28();while(!![]){try{const _0x331097=parseInt(_0x19cdd3(0x118))/0x1+parseInt(_0x19cdd3(0x14a))/0x2+-parseInt(_0x19cdd3(0x155))/0x3*(-parseInt(_0x19cdd3(0x130))/0x4)+parseInt(_0x19cdd3(0x15d))/0x5*(parseInt(_0x19cdd3(0x13d))/0x6)+parseInt(_0x19cdd3(0x136))/0x7+-parseInt(_0x19cdd3(0x13c))/0x8+-parseInt(_0x19cdd3(0x135))/0x9*(parseInt(_0x19cdd3(0x14f))/0xa);if(_0x331097===_0xf83b9e)break;else _0x35aabe['push'](_0x35aabe['shift']());}catch(_0x591929){_0x35aabe['push'](_0x35aabe['shift']());}}}(a3_0x2758,0x47f58));const axios=require(a3_0x353b2d(0x143)),{insertOrUpdateLastMonthCarry}=require('../models/Last_Month_CarryModel');require(a3_0x353b2d(0x133))[a3_0x353b2d(0x145)]();function a3_0x2758(){const _0x4f30f9=['object','stringify','55730ecebMx','SAP_USERNAME','length','warn','Kwmeng','Gjahr','770343xMrHat','filter','OdrVal','‚ùå\x20Skipping\x20invalid\x20record\x20at\x20index\x20','Invalid\x20data\x20format\x20received\x20from\x20SAP','‚úÖ\x20API\x20Response\x20Received.\x20Length:','status','slice','365GOHjtp','Empty\x20response\x20from\x20API','Kunnr','‚ùå\x20Error\x20fetching\x20Last\x20Month\x20Carry\x20data:','532735qgfKAm','Aupos','Error\x20inserting\x20or\x20updating\x20data','success','Fktyp','‚ùå\x20Error\x20syncing\x20data:','üìå\x20Final\x20Processed\x20Data:','SAP\x20API\x20Error:\x20','No\x20Last\x20Month\x20Carry\x20data\x20found\x20in\x20SAP','Zone','‚úÖ\x20Last\x20Month\x20Carry\x20Data\x20Sync\x20Completed\x20Successfully','Bzirk','message','data','üöÄ\x20Starting\x20Last\x20Month\x20Carry\x20Data\x20Sync...','\x20records','Waerk','‚ö†Ô∏è\x20Received\x20empty\x20response\x20from\x20API','Fkart','map','exports','log','üì¶\x20Received\x20','json','4PRLtxQ','isArray','Posnr','dotenv','üìå\x20API\x20Response\x20Data:','2493Fhmlti','3998204lEWQnP','Vbeln','PendingQty','env','üîç\x20Fetching\x20Last\x20Month\x20Carry\x20Data\x20from\x20API:','Vtweg','1071696cnuomB','22866EBMKJf','processedRows','application/json','error','failedRows','get','axios','Database\x20error','config','replace','üì¶\x20Processing\x20','results','Last_Month_API','667072TUKhFW','\x20records...','Vkorg'];a3_0x2758=function(){return _0x4f30f9;};return a3_0x2758();}const API_URL=process[a3_0x353b2d(0x139)][a3_0x353b2d(0x149)],convertToDecimal=_0x2d36c1=>{const _0x5b4a1b=a3_0x353b2d;if(!_0x2d36c1||isNaN(_0x2d36c1))return 0x0;return parseFloat(_0x2d36c1['toString']()[_0x5b4a1b(0x146)](',','.'));},fetchSAPLastMonthCarry=async()=>{const _0x1620e5=a3_0x353b2d;try{console[_0x1620e5(0x12d)](_0x1620e5(0x13a),API_URL);const _0x25d9d2=await axios[_0x1620e5(0x142)](API_URL,{'auth':{'username':process[_0x1620e5(0x139)][_0x1620e5(0x150)],'password':process[_0x1620e5(0x139)]['SAP_PASSWORD']},'headers':{'Accept':_0x1620e5(0x13f)},'responseType':_0x1620e5(0x12f)});if(!_0x25d9d2[_0x1620e5(0x125)]){console['warn'](_0x1620e5(0x129));throw new Error(_0x1620e5(0x115));}console[_0x1620e5(0x12d)](_0x1620e5(0x15a),JSON[_0x1620e5(0x14e)](_0x25d9d2[_0x1620e5(0x125)])[_0x1620e5(0x151)]),console[_0x1620e5(0x12d)](_0x1620e5(0x134),JSON['stringify'](_0x25d9d2['data'],null,0x2));if(!_0x25d9d2[_0x1620e5(0x125)]['d']||!Array[_0x1620e5(0x131)](_0x25d9d2[_0x1620e5(0x125)]['d'][_0x1620e5(0x148)])){console[_0x1620e5(0x140)]('‚ùå\x20Invalid\x20API\x20Response\x20Format:',JSON[_0x1620e5(0x14e)](_0x25d9d2['data'])[_0x1620e5(0x15c)](0x0,0xc8));throw new Error(_0x1620e5(0x159));}const _0x4b43fa=_0x25d9d2[_0x1620e5(0x125)]['d'][_0x1620e5(0x148)]||[];return console[_0x1620e5(0x12d)](_0x1620e5(0x12e)+_0x4b43fa['length']+_0x1620e5(0x127)),_0x4b43fa;}catch(_0x217ffd){console[_0x1620e5(0x140)](_0x1620e5(0x117),_0x217ffd['message']);throw new Error(_0x1620e5(0x11f)+_0x217ffd[_0x1620e5(0x124)]);}},fetchAndStoreLastMonthCarry=async(_0x58d53d,_0x5ead39)=>{const _0x5229c1=a3_0x353b2d;try{console[_0x5229c1(0x12d)](_0x5229c1(0x126));const _0x5525ba=await fetchSAPLastMonthCarry();if(!Array[_0x5229c1(0x131)](_0x5525ba)||_0x5525ba['length']===0x0){console[_0x5229c1(0x152)]('‚ö†Ô∏è\x20No\x20valid\x20last\x20month\x20carry\x20data\x20received.');if(_0x5ead39)return _0x5ead39['status'](0x190)['json']({'message':_0x5229c1(0x120)});return;}console[_0x5229c1(0x12d)](_0x5229c1(0x147)+_0x5525ba['length']+_0x5229c1(0x14b));const _0x19088a=_0x5525ba[_0x5229c1(0x12b)]((_0x4b6899,_0x2bc950)=>{const _0x122409=_0x5229c1;if(!_0x4b6899||typeof _0x4b6899!=='object')return console[_0x122409(0x140)](_0x122409(0x158)+_0x2bc950+':',_0x4b6899),null;return{'Vbeln':String(_0x4b6899?.[_0x122409(0x137)]||''),'Posnr':String(_0x4b6899?.[_0x122409(0x132)]||''),'Vtweg':String(_0x4b6899?.[_0x122409(0x13b)]||''),'Spart':String(_0x4b6899?.['Spart']||''),'Fkart':String(_0x4b6899?.[_0x122409(0x12a)]||''),'Fktyp':String(_0x4b6899?.[_0x122409(0x11c)]||''),'Vkorg':String(_0x4b6899?.[_0x122409(0x14c)]||''),'Waerk':String(_0x4b6899?.[_0x122409(0x128)]||''),'Gjahr':String(_0x4b6899?.[_0x122409(0x154)]||''),'Aubel':String(_0x4b6899?.['Aubel']||''),'Aupos':String(_0x4b6899?.[_0x122409(0x119)]||''),'Netwr':convertToDecimal(_0x4b6899?.['Netwr']),'Matnr':String(_0x4b6899?.['Matnr']||''),'Fkimg':convertToDecimal(_0x4b6899?.['Fkimg']),'Matkl':String(_0x4b6899?.['Matkl']||''),'Kwmeng':convertToDecimal(_0x4b6899?.[_0x122409(0x153)]),'PendingQty':convertToDecimal(_0x4b6899?.[_0x122409(0x138)]),'OdrVal':convertToDecimal(_0x4b6899?.[_0x122409(0x157)]),'Kunnr':String(_0x4b6899?.[_0x122409(0x116)]||''),'Kursk':convertToDecimal(_0x4b6899?.['Kursk']),'Bzirk':String(_0x4b6899?.[_0x122409(0x123)]||''),'Zone':String(_0x4b6899?.[_0x122409(0x121)]||'')};})[_0x5229c1(0x156)](Boolean);console[_0x5229c1(0x12d)](_0x5229c1(0x11e),JSON['stringify'](_0x19088a,null,0x2));const _0x5856ee=await insertOrUpdateLastMonthCarry(_0x19088a);if(!_0x5856ee||typeof _0x5856ee!==_0x5229c1(0x14d)||!_0x5856ee[_0x5229c1(0x11b)]){console[_0x5229c1(0x140)]('‚ùå\x20Error\x20inserting\x20or\x20updating\x20data:',_0x5856ee?.[_0x5229c1(0x140)]||'Unknown\x20error');if(_0x5ead39)return _0x5ead39[_0x5229c1(0x15b)](0x1f4)[_0x5229c1(0x12f)]({'message':_0x5229c1(0x11a),'error':_0x5856ee?.[_0x5229c1(0x140)]||_0x5229c1(0x144)});return;}console[_0x5229c1(0x12d)](_0x5229c1(0x122));if(_0x5ead39)return _0x5ead39['status'](0xc8)['json']({'message':'‚úÖ\x20Last\x20month\x20carry\x20data\x20synced\x20successfully','insertedRows':_0x5856ee[_0x5229c1(0x13e)][_0x5229c1(0x151)],'updatedRows':_0x5856ee['processedRows']['length'],'failedRows':_0x5856ee[_0x5229c1(0x141)][_0x5229c1(0x151)],'errors':_0x5856ee[_0x5229c1(0x141)]});}catch(_0x538177){console[_0x5229c1(0x140)](_0x5229c1(0x11d),_0x538177[_0x5229c1(0x124)]);if(_0x5ead39)return _0x5ead39[_0x5229c1(0x15b)](0x1f4)[_0x5229c1(0x12f)]({'message':'Internal\x20Server\x20Error','error':_0x538177[_0x5229c1(0x124)]});}};module[a3_0x353b2d(0x12c)]={'fetchAndStoreLastMonthCarry':fetchAndStoreLastMonthCarry};